"use strict";class t{constructor(t){this.msLeft=t,this.lastDuration=t}calculatedEnd=0;msLeft=0;running=!1;stopRequested=!1;pauseRequested=!1;lastDuration;notifyPoints=[];addNotifyPoint(t,e){this.notifyPoints.push({msLeft:t,text:e,triggered:!1})}stop(){this.stopRequested=!0,this.msLeft=0,this.setDuration(this.lastDuration)}reschedule(){this.calculatedEnd=performance.now()+this.msLeft;for(const t of this.notifyPoints)t.triggered=t.msLeft>=this.msLeft}toggle(){return this.running?(this.pauseRequested=!0,e.Paused):(this.running=!0,this.pauseRequested=!1,this.stopRequested=!1,this.reschedule(),e.Continue)}tick(){let t=Math.max(this.calculatedEnd-performance.now(),0);const s=[];for(const e of this.notifyPoints)t<=e.msLeft&&!e.triggered&&(e.triggered=!0,s.push(e));return t<=0?(this.running=!1,this.msLeft=0,[e.Elapsed,s]):this.stopRequested?(this.running=!1,[e.Stopped,s]):this.pauseRequested?(this.running=!1,this.msLeft=t,[e.Paused,s]):(this.msLeft=t,[e.Continue,s])}get canStop(){return(this.running||this.msLeft>0)&&this.msLeft!==this.lastDuration}get canToggle(){return this.running||this.msLeft>0}setDuration(t){this.msLeft=t,this.lastDuration=t,this.reschedule()}}var e;!function(t){t[t.Continue=0]="Continue",t[t.Stopped=1]="Stopped",t[t.Paused=2]="Paused",t[t.Elapsed=3]="Elapsed"}(e||(e={}));function s(t){setTimeout(t,10)}function i(t,e=!0){let s=(""+Math.floor(t/36e5)).padStart(2,"0"),i=(""+Math.floor(t/6e4%60)).padStart(2,"0"),n=(""+Math.floor(t/1e3)%60).padStart(2,"0"),o=(""+Math.floor(t%1e3/10)).padStart(2,"0");return e?`${s}:${i}:${n}.${o}`:`${s}:${i}:${n}`}function n(t){return new Promise(((e,s)=>{function i(){t.removeEventListener("ended",i),e()}t.addEventListener("ended",i),t.play().catch((t=>{removeEventListener("ended",i),s(t)}))}))}async function o(t){if(!window.SpeechSynthesisUtterance||!window.speechSynthesis)return;let e=new SpeechSynthesisUtterance(t);e.lang="en-US",window.speechSynthesis.speak(e)}function r(t){let e=t.indexOf(".");if(e<0)return{parsed:void 0,success:!1};let s=t.slice(e+1);if(2!==s.length)return{parsed:void 0,success:!1};let i=a(s);if(null==i)return{parsed:void 0,success:!1};let n=t.slice(0,e).split(":");if(n.some((t=>t.length>2)))return{parsed:void 0,success:!1};let o=n.map((t=>a(t))).reverse();if(o.some((t=>null==t||t>=60)))return{parsed:void 0,success:!1};if(o.length>3||o.length<1)return{parsed:void 0,success:!1};let r=o,u=10*i+1e3*r[0];return r.length>=2&&(u+=1e3*r[1]*60),r.length>=3&&(u+=1e3*r[2]*60*60),{parsed:u,success:!0}}function a(t){return/^[0-9]+$/.test(t)?+t:void 0}new class{constructor(){const t=localStorage.getItem("theme-selected");"auto"!==t&&t?(this.setTheme(t),this.setThemeSelectorValue(t)):(this.setTheme(this.getCurrentDefaultTheme()),this.setThemeSelectorValue("auto"));const e=document.querySelector("[name=color_theme]");e&&e.addEventListener("change",(t=>{t.target&&this.onThemeSwitch(t.target.value)}))}setTheme(t){const e="auto"===t?this.getCurrentDefaultTheme():t;document.documentElement.classList.forEach((t=>{t.startsWith("theme--")&&document.documentElement.classList.remove(t)})),document.documentElement.classList.add(`theme--${e}`)}setThemeSelectorValue(t){const e=document.querySelector("select[name=color_theme]");e&&(e.value=t)}getCurrentDefaultTheme(){const t=localStorage.getItem("light-theme")||"light",e=localStorage.getItem("dark-theme")||"dark";return matchMedia("(prefers-color-scheme: dark)").matches?e:t}onThemeSwitch(t){if(this.setTheme(t),"auto"!==t){const e=this.isThemeDark(t);localStorage.setItem(e?"dark-theme":"light-theme",t)}localStorage.setItem("theme-selected",t)}isThemeDark(t){const e=document.querySelector(`select[name=color_theme] option[value=${t}]`);if(!e)throw new Error(`Theme ${t} not found`);const s=e.dataset.isDark;if("true"!==s&&"false"!==s)throw new Error(`Configuration for theme ${t} is invalid: data-is-dark is missing`);return JSON.parse(s)}},new class{constructor(){this.counter=new t(6e5),this.counter.addNotifyPoint(3e4,"30 seconds left"),this.counter.addNotifyPoint(6e4,"1 minute left"),this.counter.addNotifyPoint(3e5,"5 minutes left"),this.counter.addNotifyPoint(6e5,"10 minutes left"),this.counter.addNotifyPoint(18e5,"30 minutes left");const e=matchMedia("(prefers-reduced-motion: reduce)");e.addEventListener("change",(t=>{this.reducedMotion=t.matches})),this.reducedMotion=e.matches,this.input=document.querySelector("#timer-input"),this.input.addEventListener("blur",this.applyInputValue.bind(this)),this.input.addEventListener("input",this.onInputChange.bind(this)),this.input.addEventListener("keydown",this.onInputKeydown.bind(this)),this.inputContainer=document.querySelector(".timer-input"),this.progress=document.querySelector("#progress-bar"),window.onbeforeunload=this.onBeforeUnload.bind(this),this.updateTimeDisplay(),document.body.addEventListener("click",(t=>{let e=t.target;if(e instanceof HTMLElement)if(e.classList.contains("template-button")){let t=e.dataset.template;t&&this.onChangeTemplate(t)}else e.classList.contains("stop")?this.onStop():e.classList.contains("toggle")&&this.onToggle()}))}onBeforeUnload(t){return this.counter.canStop?(t.preventDefault(),"Please don't"):void 0}onInputChange(t){this.isInputDirty=!0}onInputKeydown(t){let e;if("ArrowUp"===t.key)e=6e4;else{if("ArrowDown"!==t.key)return;e=-6e4}let{parsed:s,success:n}=r(this.input.value);if(!n||null==s)return;const o=this.input.selectionStart,a=this.input.selectionEnd;let u=s+e;u<0&&(u=0),this.input.value=i(this.reducedMotion?1e3*Math.ceil(u/1e3):u),this.isInputDirty=!0,this.input.selectionStart=o,this.input.selectionEnd=a,t.preventDefault()}applyInputValue(){if(!this.isInputDirty)return;let{parsed:t,success:e}=r(this.input.value);this.setValidationStatus(e),this.isInputDirty=!1,null!=t&&(this.counter.setDuration(t),this.updateState())}setValidationStatus(t){t!==this.isInputValid&&(this.isInputValid=t,this.input.classList.toggle("timer-input__time--invalid",!t))}onStop(){this.counter.stop(),this.updateTimeDisplay()}onToggle(){if(!this.isInputValid)return;this.counter.toggle()===e.Continue&&s(this.onTimerIteration.bind(this))}onChangeTemplate(t){this.counter.setDuration(function(t){let e=t.slice(-1),s=1;switch(e){case"s":s=1e3;break;case"m":s=6e4;break;case"h":s=36e5}let i=parseInt(t);if(isNaN(i))return 0;return i*s}(t)),this.updateTimeDisplay()}onTimerIteration(){let[t,i]=this.counter.tick();switch(this.updateTimeDisplay(),t){case e.Elapsed:!async function(t=2){let e=document.getElementById("beep-sound");if(e&&e instanceof HTMLAudioElement)for(let s=0;s<t;++s)await n(e)}();break;case e.Continue:s(this.onTimerIteration.bind(this))}for(const t of i)o(t.text)}updateTimeDisplay(){let t=this.counter.msLeft;this.input.value=i(this.reducedMotion?1e3*Math.ceil(t/1e3):t),this.isInputDirty=!1,this.setValidationStatus(!0);let e=t/this.counter.lastDuration*100;this.reducedMotion&&(e=+e.toFixed(1)),this.progress.style.width=`${e}%`,document.title=t>0?`${i(t,!1)} - Timer`:"Timer",this.updateState()}updateState(){let t=document.querySelector(".toggle");t&&(t.textContent=this.counter.running?"Pause":"Start",t.disabled=!this.counter.canToggle,t.classList.toggle("primary-active",this.counter.canToggle&&!this.counter.running));let e=document.querySelector(".stop");e&&(e.disabled=!this.counter.canStop),this.input.readOnly=this.counter.running,this.inputContainer.classList.toggle("timer-input--live",this.counter.running)}input;inputContainer;progress;counter;reducedMotion;isInputDirty=!1;isInputValid=!0};
